---
title: Excel  VBA笔记
---


# 基础概念

注释： 英文单引号开始： `' comment`


### 变量

```
'声明一个文本类型的变量
Dim s As String
'给 s 变量赋值，即 "Hello World"
s = "Hello World"
'在 A1 单元格写入 s 变量存储的数据
Range("A1").Value = s
```

### 数组

```
'创建数组
Dim s(1 to 4) As String
'给数组的元素赋值
s(1) = "Excel"
s(2) = "Word"
s(3) = "PowerPoint"
s(4) = "Outlook"
```

上述代码创建了一个长度为4个、类型为文本的一个数组。对数组，使用编号给相应位置进行赋值。


# 启用Excel开发工具

1. 在Excel功能区任一区域鼠标右键，菜单中选择`自定义功能区`
2. 在右侧选项卡列表中，找到`开发工具`并勾选
3. 点击确定，此时在功能区就可以看到`开发工具`选项

mac中-》Excel偏好设置-》视图-》开发工具

## 开发工具常用功能

- `Visual Basic`: 打开VBA编辑器
- 宏：打开宏列表，并且可以对列表中的宏进行编辑，例如运行、修改、删除等。
- 录制宏： 将键盘和鼠标操作，自动转换成 VBA 代码。
- 使用相对引用：录制宏时的设置选项。
- 宏安全性：设置 Excel 如何对待包含 VBA 代码的工作簿。因为存在一些恶意的代码，所以一般将宏安全性设置为禁用。

## 打开代码编辑器方式

- 功能区
- 在任意工作表标签上方，右键，在弹出的选项列表中，选择「查看代码」
- `Alt + F11`

# 设置宏安全性

Excel 提供 4 种宏安全性选项，在开发工具选项卡，点击「宏安全性」按钮，打开信任中心。4 种选项具体如下。

- 禁用所有宏，并且不通知
- 禁用所有宏，并发出通知
- 禁用无数字签署的所有宏
- 启用所有宏


# 编写VBA宏

1. 创建启用宏的工作簿
2. 在VBA编辑器中插入一个新模块
3. 双击模块，打开代码编辑器输入

    ```
    Sub MyCode()
      MsgBox "Hello World"
    End Sub
    ```
4. 按`F5`执行代码，弹出信息

# 录制宏

1. 准备启用宏的工作簿
2. 填写要录制的宏的信息：开发工具->代码->录制宏


# Excel中运行VBA代码

运行VBA方法：

- "开发工具"选项卡运行
- 给"形状”指定宏的方式运行
- 给"按钮"指定宏的方式运行


## 从“开发工具”选项卡运行

开发工具中打开红列表，选择想要运行的宏，点击"运行”即可


## 通过给"形状"指定宏的方式运行

Excel中的形状，可以为其指定宏，当鼠标点击时，宏自动运行

1. Excel中插入一个形状
2. 形状上右键，选择指定宏
3. 点击形状，宏执行


##  从"按钮"指定宏的运行方式

Excel内置的按钮，可以自定义并且有点击效果

1. 开发工具->插入命令
2. 点击插入命令，从类表中选择：表单控件->按钮


# 变量

## 变量声明

```
Dim <变量名> As <数据类型>

Dim name As String
Dim age As Integer
```

## 变量类型

- `Byte`: 字节， 0至255
- `Integer`: 整数 -32768至32767
- ``:
- ``:
- ``:
- ``:
- ``:
- ``:
- ``:
- ``:
- ``:
- ``:
